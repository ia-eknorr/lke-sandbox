# Infisical self-hosted configuration
# Requires: PostgreSQL (via PGO), Redis
#
# The infisical-secrets secret is auto-generated by templates/secrets.yaml
# using Helm lookup to preserve values across upgrades

infisical:
  # Reference to auto-generated secret containing ENCRYPTION_KEY, AUTH_SECRET, etc.
  kubeSecretRef: "infisical-secrets"

  # Disable bundled PostgreSQL - use external PGO cluster
  postgresql:
    enabled: false

  # Use bundled Redis for sandbox
  redis:
    enabled: true
    auth:
      password: "infisical-redis-password"
    architecture: standalone

  # Single replica for sandbox
  replicaCount: 1

  image:
    tag: "v0.154.6-postgres"

  ingress:
    enabled: false
    nginx:
      enabled: false  # Use Traefik Gateway API instead

# HTTPRoute configuration (Gateway API)
httpRoute:
  enabled: true
  hostname: ""  # Set in environment values, e.g., infisical.sandbox.knorr.casa
  gateway:
    name: traefik-gateway
    namespace: traefik
  service:
    name: infisical
    port: 8080
