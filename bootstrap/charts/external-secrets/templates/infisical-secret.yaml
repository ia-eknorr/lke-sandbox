{{/*
Infisical Machine Identity secret for ClusterSecretStore
Created from helm values when credentials are provided
*/}}
{{- if and .Values.infisical.clientId .Values.infisical.clientSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.clusterSecretStore.secretRef.name }}
  namespace: {{ .Values.clusterSecretStore.secretRef.namespace | default .Release.Namespace }}
  labels:
    app.kubernetes.io/managed-by: Helm
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  {{ .Values.clusterSecretStore.secretRef.clientIdKey | default "clientId" }}: {{ .Values.infisical.clientId | quote }}
  {{ .Values.clusterSecretStore.secretRef.clientSecretKey | default "clientSecret" }}: {{ .Values.infisical.clientSecret | quote }}
{{- end }}
