# Traefik Helm values for Gateway API mode

# Enable Gateway API provider
providers:
  kubernetesGateway:
    enabled: true

# Disable default IngressRoute provider (using Gateway API instead)
ingressRoute:
  dashboard:
    enabled: false

api:
  dashboard: true
  insecure: true

service:
  type: LoadBalancer
  annotations:
    # Linode-specific annotations (optional)
    service.beta.kubernetes.io/linode-loadbalancer-throttle: "4"

gateway:
  enabled: true
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  listeners:
    web:
      port: 8000
      protocol: HTTP
      hostname: "*.sandbox.knorr.casa"
      namespacePolicy:
        from: All
    websecure:
      port: 8443
      protocol: HTTPS
      hostname: "*.sandbox.knorr.casa"
      namespacePolicy:
        from: All
      certificateRefs:
        - name: sandbox-wildcard-tls
          kind: Secret
      mode: Terminate

    # Apex domain listener
    websecure-apex:
      port: 8443
      protocol: HTTPS
      hostname: "sandbox.knorr.casa"
      namespacePolicy:
        from: All
      certificateRefs:
        - name: sandbox-wildcard-tls
          kind: Secret
      mode: Terminate

# Entry points
ports:
  traefik:
    port: 9000
    expose:
      default: true
    exposedPort: 9000
    protocol: TCP
  web:
    port: 8000
    exposedPort: 80
    protocol: TCP
    redirections:
      entryPoint:
        to: websecure
        scheme: https
        permanent: true   
  websecure:
    port: 8443
    exposedPort: 443
    protocol: TCP

# Enable access logs (optional, helpful for debugging)
logs:
  access:
    enabled: true

# Resource limits
resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "256Mi"

extraObjects:
- |
  apiVersion: gateway.networking.k8s.io/v1
  kind: HTTPRoute
  metadata:
    name: traefik-dashboard
    namespace: traefik
  spec:
    parentRefs:
      - name: traefik-gateway
        namespace: traefik
    hostnames:
      - "traefik.sandbox.knorr.casa"
    rules:
      - matches:
          - path:
              type: PathPrefix
              value: /
        backendRefs:
          - name: traefik
            port: 9000
additionalArguments:
- "--api.insecure=true"